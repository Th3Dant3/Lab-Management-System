<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Coating Tracker Tool</title>
  <link rel="stylesheet" href="coating.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<div class="container">

  <!-- ================= TOP NAV ================= -->
  <div class="top-nav">
    <button class="back-btn" onclick="goBack()">← Back to Dashboard</button>
  </div>

  <h1>Coating Tracker</h1>

  <!-- ================= FILTERS ================= -->
  <div class="filters-bar">

    <!-- Shift Filter -->
    <div class="shift-filter">
      <label for="shiftSelect">Shift:</label>
      <select id="shiftSelect">
        <option value="All">All Shifts</option>
        <option value="Weekday Shift">Weekday Shift</option>
        <option value="Weekend Shift">Weekend Shift</option>
      </select>
    </div>

    <!-- Date Filter -->
    <div class="date-filter">
      <label for="historyDate">Date:</label>
      <input type="date" id="historyDate" />
	  <<button id="historyRefreshBtn">Refresh</button>
    </div>
	<!-- ✅ ADD THIS RIGHT HERE -->
  <div id="activeReportDate" class="report-date-indicator">
    Viewing Report Date: --
  </div>

  </div>

  <!-- ================= MAIN NAV TABS ================= -->
  <div class="tabs main-tabs">

    <button class="tab active" onclick="showTab('overview', this)">
      Overview
    </button>

    <button class="tab" onclick="showTab('trends', this)">
      Trends
    </button>

    <button class="tab" onclick="showTab('reasons', this)">
      Top Reasons
    </button>

    <button class="tab" onclick="showTab('machines', this)">
      Machine Analysis
    </button>

  </div>

  <!-- ================= OVERVIEW ================= -->
  <div id="overview" class="tab-content active">

    <!-- PRIMARY KPI ROW -->
    <div class="summary">

      <div class="card">
        <h3>Total Jobs</h3>
        <h2 id="totalJobs"></h2>
      </div>

      <div class="card">
        <h3>RX Breakage %</h3>
        <h2 id="rxBreakage"></h2>
      </div>

      <div class="card same">
        <h3>Total Breakage</h3>
        <h2 id="totalBreakage"></h2>
      </div>

      <div class="card">
        <h3>Total Lenses Broken</h3>
        <h2 id="totalLenses"></h2>
      </div>

      <div class="card">
        <h3>Breakage Peak Hour</h3>
        <h2 id="peakHour"></h2>
      </div>

    </div>

    <!-- SECONDARY KPI ROW -->
    <div class="summary">

      <div class="card">
        <h3>Breakage Avg Time (hrs)</h3>
        <h2 id="avgTime"></h2>
      </div>

    </div>

    <h2>Hourly Breakdown</h2>

    <table>
      <thead>
        <tr>
          <th>Hour</th>
          <th>Total Lenses Broken</th>
          <th>Coating Jobs</th>
          <th>Primary Driver</th>
        </tr>
      </thead>
      <tbody id="hourlyBody"></tbody>
    </table>

  </div>

  <!-- ================= TRENDS ================= -->
  <div id="trends" class="tab-content">

    <h2 style="margin-top:0;">Breakage Trend</h2>

    <div style="text-align:center; margin-bottom:20px;">
      <button id="processedBtn"
              class="mode-btn active"
              onclick="switchTrend('processed')">
        Breakage Processed
      </button>

      <button id="machineBtn"
              class="mode-btn"
              onclick="switchTrend('machine')">
        Machine Scan
      </button>
    </div>

    <div class="trend-card" style="height:450px; margin-bottom:40px;">
      <canvas id="trendChart"></canvas>
    </div>

    <h2>Detaper → Coater Flow Analysis</h2>

    <div style="text-align:center; margin-bottom:20px;">
      <button id="avgFlowBtn"
              class="mode-btn active"
              onclick="switchFlowMode('average')">
        Average Flow
      </button>

      <button id="individualFlowBtn"
              class="mode-btn"
              onclick="switchFlowMode('individual')">
        Individual RX
      </button>
    </div>

    <div class="trend-card" style="height:500px;">
      <canvas id="flowChart"></canvas>
    </div>

  </div>

  <!-- ================= REASONS ================= -->
  <div id="reasons" class="tab-content">
    <div class="full-width-chart" style="height:500px;">
      <canvas id="reasonChart"></canvas>
    </div>
  </div>

  <!-- ================= MACHINES ================= -->
  <div id="machines" class="tab-content">
    <div class="full-width-chart" style="height:500px;">
      <canvas id="machineChart"></canvas>
    </div>
  </div>

</div>

<!-- ================= MODAL ================= -->
<div id="chartModal">
  <div id="modalContent">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <div id="modalBody"></div>
  </div>
</div>

<script src="coating.js"></script>

</body>
</html>